---
layout: post
title: "Databases: Joins"
date: 2015-10-01
categories: sql databases
js_file: post
---

<blockquote>
Working with a database is often an integral part of developing software, and so it is important to understand the language of databases just as you would understand Ruby or C++.
</blockquote>

<h2 class="blog-header-2">So what are they?</h2>
<h3 class="blog-header">
  The Basics
</h3>

<div class="blog-container">
  <div class="col s12">
    <p>
      A database is just an organized collection of data used for
      many different purposes, such as storing information for analysis or maintaining records of purchases.
      The most popular databases today are <strong>relational</strong> databases, which means that there are
      <strong>relationships</strong> between the data stored in the database. Let's use Amazon for an example. When one purchases
      goods from Amazon, those transactions are added to your list of past orders. Basically, a single customer can <strong>have
      many</strong> orders. There! We just defined a relationship, a <strong>one-to-many</strong> relationship..
    </p>
    <p>
      Let's think about another kind of relationship. We all know that items that you see on Amazon often belong to categories. For example,
      a gaming console could belong to an electronics category, as well as a gaming one. But each category can also have many items within it.
      This leads to another kind of relationship, called a <strong>many-to-many</strong> relationship.
    </p>
    <p>
      Now that we have a basic understanding of what databases are, let's move on to the main topic: joins!
    </p>
  </div>
</div>

<h3 class="blog-header">
  Join Me and Learn
</h3>

<div class="blog-container">
  <div class="col s12">
    <p>
      A SQL Join is a kind of operation that combines the information from two database tables
      where certain conditions are met. Going back to the Amazon example, we could join the table holding
      information about one's account to a table holding information about orders in order to get all of the information
      for a user and their orders together.
    </p>
    <p>
      Before we can start doing any SQL, let's first create our table. I like Game of Thrones, so that's the theme of this post's SQL. It's important to note that
      I'm also using postgreSQL in all of the examples.
      {% highlight sql %}
CREATE TABLE houses (
  id serial PRIMARY KEY,
  title varchar(255)
);

CREATE TABLE characters (
  id serial PRIMARY KEY,
  name varchar(255),
  house_id INTEGER REFERENCES houses (id)
);
      {% endhighlight %}
      This makes two tables, one called <strong>houses</strong> and the other called <strong>characters</strong>. Their attributes
      are pretty simple, but it's important to note that the characters table has a foreign key reference to houses, meaning that each character's
      house_id maps up to an entry in the houses table.
    </p>
    <p>
      Now let's add some fake data in there.
      {% highlight sql %}
INSERT INTO houses (title)
VALUES
('House Targaryen'),
('House Lannister'),
('House Stark'),
('House Baratheon');

INSERT INTO characters (name, house_id)
VALUES
('Aegon Targaryen', 1),
('Daenerys Targaryen', 1),
('Jaime Lannister', 2),
('Eddard Stark', 3),
('Lyanna Stark', 3),
('Khal Drogo', NULL);
      {% endhighlight %}
    </p>
    <p>
      Cool.
    </p>
    <p>
      There are a few different kinds of joins in standard SQL. These include:
      <ul>
        <li>Inner Join</li>
        <li>Left Outer Join</li>
        <li>Right Outer Join</li>
        <li>Full Outer Join</li>
        <li>Cross Join</li>
      </ul>
    </p>
    <p>
      Each join has its own tradeoffs and advantages, which we'll cover in turn. First up...
    </p>
  </div>
</div>

<h3 class="blog-header">
  Inner Join
</h3>

<div class="blog-container">
  <div class="col s12">
    <p>
      The Inner Join is a very common kind of join, and it has some important properties. For one,
      the inner join doesn't select rows from the two tables if one of the attributes in the join condition is null.
      Additionally, even if a field is not null, if the value of an attribute referenced in the join condition appears only
      in one table, there will be no rows selected for that value.
    </p>
    <p>
      Let's see a concrete example. The following SQL performs an inner join
      on the characters and houses tables by house_id.
      {% highlight sql %}
SELECT
c.name,
c.house_id,
h.id,
h.title
FROM characters AS c
INNER JOIN
houses AS h
ON c.house_id = h.id
      {% endhighlight %}
    </p>
    <p>
      The following table holds the results of running this query on our database.
    </p>
    <table class="bordered">
      <thead>
        <tr>
          <th>name</th>
          <th>house_id</th>
          <th>id</th>
          <th>title</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Aegon Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Daenerys Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Jaime Lannister</td>
          <td>2</td>
          <td>2</td>
          <td>House Lannister</td>
        </tr>
        <tr>
          <td>Eddard Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Lyanna Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
      </tbody>
    </table>
    <p>
      We can see that the columns <strong>house_id</strong> and <strong>id</strong> match up for each row.
      Each character's <strong>house_id</strong> matches up to <strong>id</strong> of each house in the houses table. Also, going back to the important properties
      of the inner join, we can see that poor Khal Drogo is nowhere to be found. That's because he is a Dothraki and his <strong>house_id</strong> is null.
      Also, House Baratheon doesn't show up in our results set either. Why? House Baratheon has no members in the characters table.
    </p>
    <p>
      It's important to remember these behaviors when writing inner joins. One possible use case for joining on columns
      that may be null is to remove all of the rows that have a null value for that column.
    </p>
  </div>
</div>

<h3 class="blog-header">
  Outer Joins
</h3>

<h4 class="blog-header">
  Left Outer Joins
</hr>

<div class="blog-container">
  <div class="col s12">
    <p>
      Outer Joins are different from inner joins in the respect that all of the rows in the table being joined
      are retained, not just the rows that succeed in matching the join condition. As was mentioned above, there are a few
      kind of outer joins: the left, right, and full outer joins. Left and right joins are differentiated by retaining
      rows from the table based on the side of the join. For example, left joins retain all rows from the table that is on the left
      of the join word, and right outer joins do the opposite. Full outer joins combine the effects of both types of outer joins.
      As this section title indicates, we'll be working with the left outer join first.
    </p>
    <p>
      The following SQL performs a left outer join
      on the characters and houses tables by house_id.
      {% highlight sql %}
SELECT
c.name,
c.house_id,
h.id,
h.title
FROM characters AS c
LEFT OUTER JOIN
houses AS h
ON c.house_id = h.id
      {% endhighlight %}
    </p>
    <p>
      The following table holds the results of running this query on our database.
    </p>
    <table class="bordered">
      <thead>
        <tr>
          <th>name</th>
          <th>house_id</th>
          <th>id</th>
          <th>title</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Aegon Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Daenerys Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Jaime Lannister</td>
          <td>2</td>
          <td>2</td>
          <td>House Lannister</td>
        </tr>
        <tr>
          <td>Eddard Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Lyanna Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Khal Drogo</td>
          <td>null</td>
          <td>null</td>
          <td>null</td>
        </tr>
      </tbody>
    </table>
    <p>
      The result set shows that we have all of the rows in the characters table, since that
      was the one on the left side of the join. Additionally, since khal drogo does not have a corresponding
      entry in the houses table, because his <strong>house_id</strong> is null, the id and title columns in his row are null.
    </p>
  </div>
</div>

<h4 class="blog-header">
  Right Outer Joins
</hr>

<div class="blog-container">
  <div class="col s12">
    <p>
      As was mentioned before, right outer joins do the opposite of a left outer join. Instead of all of the rows being retained
      in the left table, all of the rows in the right table are kept.
    </p>
    <p>
      The following SQL performs a right outer join
      on the characters and houses tables by house_id.
      {% highlight sql %}
SELECT
c.name,
c.house_id,
h.id,
h.title
FROM characters AS c
RIGHT OUTER JOIN
houses AS h
ON c.house_id = h.id
      {% endhighlight %}
    </p>
    <p>
      The following table holds the results of running this query on our database.
    </p>
    <table class="bordered">
      <thead>
        <tr>
          <th>name</th>
          <th>house_id</th>
          <th>id</th>
          <th>title</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Aegon Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Daenerys Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Jaime Lannister</td>
          <td>2</td>
          <td>2</td>
          <td>House Lannister</td>
        </tr>
        <tr>
          <td>Eddard Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Lyanna Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>null</td>
          <td>null</td>
          <td>4</td>
          <td>House Baratheon</td>
        </tr>
      </tbody>
    </table>
    <p>
      We can see that we have all of the rows in the houses table. In the last row, for House Baratheon,
      there is no character information association with it. That's because no rows in he characters table
      are linked to House Baratheon by their <strong>house_id</strong>
    </p>
  </div>
</div>

<h4 class="blog-header">
  Full Outer Joins
</hr>

<div class="blog-container">
  <div class="col s12">
    <p>
      The last type of outer join is a full outer join. This join retains all of the rows from both
      tables.
    </p>
    <p>
      The following SQL performs a full outer join
      on the characters and houses tables by house_id.
      {% highlight sql %}
SELECT
c.name,
c.house_id,
h.id,
h.title
FROM characters AS c
FULL OUTER JOIN
houses AS h
ON c.house_id = h.id
      {% endhighlight %}
    </p>
    <p>
      The following table holds the results of running this query on our database.
    </p>
    <table class="bordered">
      <thead>
        <tr>
          <th>name</th>
          <th>house_id</th>
          <th>id</th>
          <th>title</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Aegon Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Daenerys Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Jaime Lannister</td>
          <td>2</td>
          <td>2</td>
          <td>House Lannister</td>
        </tr>
        <tr>
          <td>Eddard Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Lyanna Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Khal Drogo</td>
          <td>null</td>
          <td>null</td>
          <td>null</td>
        </tr>
        <tr>
          <td>null</td>
          <td>null</td>
          <td>4</td>
          <td>House Baratheon</td>
        </tr>
      </tbody>
    </table>
    <p>
      Our results now contains a row for each match between a character's <strong>house_id</strong> and a house's <strong>id</strong>,
      in addition to all of the rows from both tables that have no matches. We see both Khal Drogo
      and House Baratheon in our result set.
    </p>
  </div>
</div>

<h4 class="blog-header">
  Cross Joins
</hr>

<div class="blog-container">
  <div class="col s12">
    <p>
      The final join I will cover in this post is the Cross Join. The cross join is kind of
      similar to the full outer join in the respect that all of the rows from both tables are used
      in the join. What a cross join actually does is compute a Cartesian Product of the two tables.
      More specifically, for every row in the first table, it will join that to every row in the second table, combining the information.
      So, if we have <strong>6<strong> rows in our characters table and <strong>4</strong> rows in our houses table,
      the result of our cross join will have 24 rows!
    </p>
    <p>
      The following SQL performs a cross join
      on the characters and houses tables by house_id.
      {% highlight sql %}
SELECT
c.name,
c.house_id,
h.id,
h.title
FROM characters AS c
CROSS JOIN
houses AS h
ON c.house_id = h.id
      {% endhighlight %}
    </p>
    <p>
      The following table holds the results of running this query on our database.
    </p>
    <table class="bordered">
      <thead>
        <tr>
          <th>name</th>
          <th>house_id</th>
          <th>id</th>
          <th>title</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Aegon Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Aegon Targaryen</td>
          <td>1</td>
          <td>2</td>
          <td>House Lannister</td>
        </tr>
        <tr>
          <td>Aegon Targaryen</td>
          <td>1</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Aegon Targaryen</td>
          <td>1</td>
          <td>4</td>
          <td>House Baratheon</td>
        </tr>
        <tr>
          <td>Daenerys Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Daenerys Targaryen</td>
          <td>1</td>
          <td>2</td>
          <td>House Lannister</td>
        </tr>
        <tr>
          <td>Daenerys Targaryen</td>
          <td>1</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Daenerys Targaryen</td>
          <td>1</td>
          <td>4</td>
          <td>House Baratheon</td>
        </tr>
        <tr>
          <td>Jaime Lannister</td>
          <td>2</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Jaime Lannister</td>
          <td>2</td>
          <td>2</td>
          <td>House Lannister</td>
        </tr>
        <tr>
          <td>Jaime Lannister</td>
          <td>2</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Jaime Lannister</td>
          <td>2</td>
          <td>24</td>
          <td>House Baratheon</td>
        </tr>
        <tr>
          <td>Eddard Stark</td>
          <td>3</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Eddard Stark</td>
          <td>3</td>
          <td>2</td>
          <td>House Lannister</td>
        </tr>
        <tr>
          <td>Eddard Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Eddard Stark</td>
          <td>3</td>
          <td>4</td>
          <td>House Baratheon</td>
        </tr>
        <tr>
          <td>Lyanna Stark</td>
          <td>3</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Lyanna Stark</td>
          <td>3</td>
          <td>2</td>
          <td>House Lannister</td>
        </tr>
        <tr>
          <td>Lyanna Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Lyanna Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Baratheon</td>
        </tr>
        <tr>
          <td>Khal Drogo</td>
          <td>null</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Khal Drogo</td>
          <td>null</td>
          <td>2</td>
          <td>House Lannister</td>
        </tr>
        <tr>
          <td>Khal Drogo</td>
          <td>null</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Khal Drogo</td>
          <td>null</td>
          <td>4</td>
          <td>House Baratheon</td>
        </tr>
      </tbody>
    </table>
    <p>
      Our results now contains a row for each match between a character's <strong>house_id</strong> and a house's <strong>id</strong>,
      in addition to all of the rows from both tables that have no matches. We see both Khal Drogo
      and House Baratheon in our result set.
    </p>
  </div>
</div>
