---
layout: post
title: "Databases: Joins"
date: 2015-10-01
categories: sql databases
js_file: post
---

<blockquote>
Working with a database is often an integral part of developing software, and so it is important to understand the language of databases just as you would understand Ruby or C++.
</blockquote>

<h2 class="blog-header-2">So what are they?</h2>
<h3 class="blog-header">
  The Basics
</h3>

<div class="blog-container">
  <div class="col s12">
    <p>
      A database is just an organized collection of data used for
      many different purposes, such as storing information for analysis or maintaining records of purchases.
      The most popular databases today are <strong>relational</strong> databases, which means that there are
      <strong>relationships</strong> between the data stored in the database. Let's use Amazon for an example. When one purchases
      goods from Amazon, those transactions are added to your list of past orders. Basically, a single customer can <strong>have
      many</strong> orders. There! We just defined a relationship, a <strong>one-to-many</strong> relationship..
    </p>
    <p>
      Let's think about another kind of relationship. We all know that items that you see on Amazon often belong to categories. For example,
      a gaming console could belong to an electronics category, as well as a gaming one. But each category can also have many items within it.
      This leads to another kind of relationship, called a <strong>many-to-many</strong> relationship.
    </p>
    <p>
      Now that we have a basic understanding of what databases are, let's move on to the main topic: joins!
    </p>
  </div>
</div>

<h3 class="blog-header">
  Join Me and Learn
</h3>

<div class="blog-container">
  <div class="col s12">
    <p>
      A SQL Join is a kind of operation that combines the information from two database tables
      where certain conditions are met. Going back to the Amazon example, we could join the table holding
      information about one's account to a table holding information about orders in order to get all of the information
      for a user and their orders together.
    </p>
    <p>
      Before we can start doing any SQL, let's first create our table. I like Game of Thrones, so that's the theme of this post's SQL. It's important to note that
      I'm also using postgreSQL in all of the examples.
      {% highlight sql %}
CREATE TABLE houses (
  id serial PRIMARY KEY,
  title varchar(255)
);

CREATE TABLE characters (
  id serial PRIMARY KEY,
  name varchar(255),
  house_id INTEGER REFERENCES houses (id)
);
      {% endhighlight %}
      This makes two tables, one called <strong>houses</strong> and the other called <strong>characters</strong>. Their attributes
      are pretty simple, but it's important to note that the characters table has a foreign key reference to houses, meaning that each character's
      house_id maps up to an entry in the houses table.
    </p>
    <p>
      Now let's add some fake data in there.
      {% highlight sql %}
INSERT INTO houses (title)
VALUES
('House Targaryen'),
('House Lannister'),
('House Stark'),
('House Baratheon');

INSERT INTO characters (name, house_id)
VALUES
('Aegon Targaryen', 1),
('Daenerys Targaryen', 1),
('Jaime Lannister', 2),
('Eddard Stark', 3),
('Lyanna Stark', 3),
('Khal Drogo', NULL);
      {% endhighlight %}
    </p>
    <p>
      Cool.
    </p>
    <p>
      There are a few different kinds of joins in standard SQL. These include:
      <ul>
        <li>Inner Join</li>
        <li>Left Outer Join</li>
        <li>Right Outer Join</li>
        <li>Full Outer Join</li>
        <li>Cross Join</li>
      </ul>
    </p>
    <p>
      Each join has its own tradeoffs and advantages, which we'll cover in turn. First up...
    </p>
  </div>
</div>

<h3 class="blog-header">
  Inner Join
</h3>

<div class="blog-container">
  <div class="col s12">
    <p>
      The Inner Join is a very common kind of join, and it has some important properties. For one,
      the inner join doesn't select rows from the two tables if one of the attributes in the join condition is null.
      Additionally, even if a field is not null, if the value of an attribute referenced in the join condition appears only
      in one table, there will be no rows selected for that value.
    </p>
    <p>
      Let's see a concrete example. The following SQL performs an inner join
      on the characters and houses tables by house_id.
      {% highlight sql %}
SELECT
c.name,
c.house_id,
h.id,
h.title
FROM characters AS c
INNER JOIN
houses AS h
ON c.house_id = h.id
      {% endhighlight %}
      The following table holds the results of running this query on our database.
    </p>
    <table class="bordered">
      <thead>
        <tr>
          <th>name</th>
          <th>house_id</th>
          <th>id</th>
          <th>title</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Aegon Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Daenerys Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Jaime Lannister</td>
          <td>2</td>
          <td>2</td>
          <td>House Lannister</td>
        </tr>
        <tr>
          <td>Eddard Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Lyanna Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
      </tbody>
    </table>
    <p>
      We can see that the columns <strong>house_id</strong> and <strong>id</strong> match up for each row.
      Each character's house_id matches up to id of each house in the houses table. Also, going back to the important properties
      of the inner join, we can see that poor Khal Drogo is nowhere to be found. That's because he is a Dothraki and his house_id is null.
      Also, House Baratheon doesn't show up in our results set either. Why? House Baratheon has no members in the characters table.
    </p>
    <p>
      It's important to remember these behaviors when writing inner joins. One possible use case for joining on columns
      that may be null is to remove all of the rows that have a null value for that column.
    </p>
  </div>
</div>

<h3 class="blog-header">
  Outer Join
</h3>

<div class="blog-container">
  <div class="col s12">
    <p>
      The Inner Join is a very common kind of join, and it has some important properties. For one,
      the inner join doesn't select rows from the two tables if one of the attributes in the join condition is null.
      Additionally, even if a field is not null, if the value of an attribute referenced in the join condition appears only
      in one table, there will be no rows selected for that value.
    </p>
    <p>
      Let's see a concrete example. The following SQL performs an inner join
      on the characters and houses tables by house_id.
      {% highlight sql %}
SELECT
c.name,
c.house_id,
h.id,
h.title
FROM characters AS c
INNER JOIN
houses AS h
ON c.house_id = h.id
      {% endhighlight %}
      The following table holds the results of running this query on our database.
    </p>
    <table class="bordered">
      <thead>
        <tr>
          <th>name</th>
          <th>house_id</th>
          <th>id</th>
          <th>title</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Aegon Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Daenerys Targaryen</td>
          <td>1</td>
          <td>1</td>
          <td>House Targaryen</td>
        </tr>
        <tr>
          <td>Jaime Lannister</td>
          <td>2</td>
          <td>2</td>
          <td>House Lannister</td>
        </tr>
        <tr>
          <td>Eddard Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
        <tr>
          <td>Lyanna Stark</td>
          <td>3</td>
          <td>3</td>
          <td>House Stark</td>
        </tr>
      </tbody>
    </table>
    <p>
      We can see that the columns <strong>house_id</strong> and <strong>id</strong> match up for each row.
      Each character's house_id matches up to id of each house in the houses table. Also, going back to the important properties
      of the inner join, we can see that poor Khal Drogo is nowhere to be found. That's because he is a Dothraki and his house_id is null.
      Also, House Baratheon doesn't show up in our results set either. Why? House Baratheon has no members in the characters table.
    </p>
    <p>
      It's important to remember these behaviors when writing inner joins. One possible use case for joining on columns
      that may be null is to remove all of the rows that have a null value for that column.
    </p>
  </div>
</div>
